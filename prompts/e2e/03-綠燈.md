# TDD ç¶ ç‡ˆéšæ®µï¼šè®“ E2E æ¸¬è©¦é€šé

## ç›®æ¨™

åœ¨ TDD ç´…ç‡ˆéšæ®µå·²ç¶“å¯«å¥½ E2E æ¸¬è©¦ä¸¦ç¢ºèªå¤±æ•—ã€‚ç¾åœ¨é€²å…¥ç¶ ç‡ˆéšæ®µï¼š

**å¯«æœ€å°‘çš„ç¨‹å¼ç¢¼è®“æ¸¬è©¦é€šéï¼Œå¯¦ä½œå¾Œç«¯ APIï¼Œä¸æ–· trial-and-error ç›´åˆ°æ‰€æœ‰æ¸¬è©¦è®Šç¶ ã€‚**

---

## ç¨‹å¼æ¶æ§‹è¦ç¯„

**é‡è¦**ï¼šæœ¬ prompt çš„æ‰€æœ‰ç¨‹å¼é–‹ç™¼å¿…é ˆéµå¾ª `@prompts/rules/ç¨‹å¼æ¶æ§‹è¦ç¯„.md` çš„è¦å‰‡ã€‚

è©²æ–‡ä»¶å®šç¾©äº†ï¼š
- æª”æ¡ˆçµ„ç¹”çµæ§‹ï¼ˆAPI Routesã€Servicesã€Prisma Modelsã€Zod Schemas çš„æ“ºæ”¾ä½ç½®ï¼‰
- åˆ†å±¤æ¶æ§‹è·è²¬ï¼ˆRoute Handlerã€Serviceã€Prisma çš„è·è²¬åˆ†é…ï¼‰
- ä¾è³´æ³¨å…¥åŸå‰‡
- æª”æ¡ˆå‰µå»ºé †åº

åœ¨å¯¦ä½œéç¨‹ä¸­ï¼Œè«‹å…ˆé–±è®€è©²æ¶æ§‹è¦ç¯„æ–‡ä»¶ï¼Œç¢ºä¿æ‰€æœ‰ç¨‹å¼ç¢¼ç¬¦åˆè¦ç¯„ã€‚

---

## æ ¸å¿ƒåŸå‰‡

### 0. æ¸¬è©¦é©…å‹•é–‹ç™¼çš„éµå¾‹

**å¿…é ˆé€éåŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦ä¾†é©—è­‰å¯¦ä½œæ˜¯å¦å®Œæˆï¼Œçµ•ä¸çŒœæ¸¬ã€‚**

- âœ… **æ¯å®Œæˆä¸€å€‹æ­¥é©Ÿï¼Œç«‹å³åŸ·è¡Œæ¸¬è©¦**
- âœ… **ç„¡éœ€è©¢å•ä½¿ç”¨è€…ï¼Œç›´æ¥ä¸‹é” Playwright æ¸¬è©¦æŒ‡ä»¤**
- âœ… **æ ¹æ“šæ¸¬è©¦çµæœæ±ºå®šä¸‹ä¸€æ­¥è¡Œå‹•**
- âŒ **çµ•ä¸å‡è¨­æ¸¬è©¦æœƒé€šé**
- âŒ **çµ•ä¸è©¢å•ã€Œæ¸¬è©¦é€šéäº†å—ï¼Ÿã€**

**æ¸¬è©¦åŸ·è¡Œç­–ç•¥ï¼ˆé‡è¦ï¼‰**ï¼š

1. **é–‹ç™¼éšæ®µï¼šå…ˆè·‘ç›®æ¨™æƒ…å¢ƒçš„ç‰¹å®šæ¸¬è©¦**
   - å¿«é€Ÿé©—è­‰ç•¶å‰å¯¦ä½œ
   - ç¸®çŸ­åé¥‹å¾ªç’°
   - å°ˆæ³¨æ–¼æ­£åœ¨é–‹ç™¼çš„åŠŸèƒ½

2. **å®Œæˆéšæ®µï¼šåŸ·è¡Œç¸½å›æ­¸æ¸¬è©¦**
   - ç¢ºä¿æ²’æœ‰ç ´å£æ—¢æœ‰åŠŸèƒ½
   - é©—è­‰ç³»çµ±æ•´é«”ç©©å®šæ€§
   - å¿…é ˆé€šéæ‰€æœ‰æ¸¬è©¦æ‰ç®—å®Œæˆ

**åŸ·è¡Œæ¸¬è©¦çš„æ™‚æ©Ÿèˆ‡ç¯„åœ**ï¼š
```
é–‹ç™¼ä¸­ï¼ˆæ¯å€‹æ­¥é©Ÿå¾Œï¼‰ï¼š
â†’ pnpm test:e2e tests/e2e/booking.spec.ts
  ï¼ˆåªè·‘ç•¶å‰åŠŸèƒ½çš„æ¸¬è©¦ï¼Œå¿«é€Ÿåé¥‹ï¼‰

â†’ pnpm test:e2e tests/e2e/booking.spec.ts -g "æ‡‰æˆåŠŸå»ºç«‹é ç´„"
  ï¼ˆåªè·‘ç‰¹å®šæ¸¬è©¦æ¡ˆä¾‹ï¼Œæ›´å¿«é€Ÿï¼‰

å®Œæˆæ™‚ï¼ˆæœ€çµ‚é©—è­‰ï¼‰ï¼š
â†’ pnpm test:e2e
  ï¼ˆè·‘æ‰€æœ‰æ¸¬è©¦ï¼Œç¢ºä¿æ²’æœ‰ç ´å£æ—¢æœ‰åŠŸèƒ½ï¼‰
```

**æ¸¬è©¦æŒ‡ä»¤ç¯„ä¾‹**ï¼š
```bash
# 1. é–‹ç™¼éšæ®µï¼šåŸ·è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
pnpm test:e2e tests/e2e/booking.spec.ts

# 2. é–‹ç™¼éšæ®µï¼šåŸ·è¡Œç‰¹å®šæ¸¬è©¦æ¡ˆä¾‹ï¼ˆæœ€å¿«ï¼‰
pnpm test:e2e tests/e2e/booking.spec.ts -g "æ‡‰æˆåŠŸå»ºç«‹é ç´„"

# 3. é–‹ç™¼éšæ®µï¼šåŸ·è¡Œç‰¹å®š describe å€å¡Š
pnpm test:e2e tests/e2e/booking.spec.ts -g "é ç´„æ™‚æ®µå¿…é ˆæœ‰å‰©é¤˜åˆ†é˜æ•¸"

# 4. å®Œæˆéšæ®µï¼šåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ï¼ˆç¸½å›æ­¸æ¸¬è©¦ï¼‰
pnpm test:e2e

# 5. åµéŒ¯æ¨¡å¼ï¼šçœ‹åˆ°ç€è¦½å™¨æ“ä½œéç¨‹
pnpm test:e2e tests/e2e/booking.spec.ts --headed

# 6. UI æ¨¡å¼ï¼šäº’å‹•å¼é™¤éŒ¯
pnpm test:e2e tests/e2e/booking.spec.ts --ui
```

**é‡è¦æé†’**ï¼š
- âœ… é–‹ç™¼æ™‚ï¼šé »ç¹åŸ·è¡Œç‰¹å®šæ¸¬è©¦ï¼ˆå¿«é€Ÿåé¥‹ï¼‰
- âœ… å®Œæˆå‰ï¼šå¿…é ˆåŸ·è¡Œ `pnpm test:e2e`ï¼ˆç¸½å›æ­¸æ¸¬è©¦ï¼‰
- âœ… åªæœ‰ç•¶**æ‰€æœ‰æ¸¬è©¦**éƒ½é€šéï¼Œæ‰ç®—å®Œæˆç¶ ç‡ˆéšæ®µ
- âŒ ä¸è¦åªè·‘ç‰¹å®šæ¸¬è©¦å°±å®£ç¨±å®Œæˆ

### 1. æœ€å°å¢é‡é–‹ç™¼åŸå‰‡

åªå¯«è®“æ¸¬è©¦é€šéæ‰€éœ€çš„æœ€å°‘ç¨‹å¼ç¢¼ï¼Œä¸è¦å¤šåšã€‚

**ç¯„ä¾‹æ¦‚å¿µ**ï¼š
```typescript
// âŒ åšå¤ªå¤šäº†ï¼ˆæ¸¬è©¦æ²’è¦æ±‚ï¼‰
// app/api/liff/appointments/route.ts
export async function POST(request: Request) {
  const body = await request.json()
  await validateInventory()        // æ²’æ¸¬è©¦
  await sendLineNotification()     // æ²’æ¸¬è©¦
  await logAuditTrail()           // æ²’æ¸¬è©¦
  return createAppointment(body)
}

// âœ… å‰›å¥½å¤ ï¼ˆåªå¯¦ä½œæ¸¬è©¦è¦æ±‚çš„ï¼‰
// app/api/liff/appointments/route.ts
export async function POST(request: Request) {
  const body = await request.json()
  return createAppointment(body)
}
```

### 2. Trial-and-Error æµç¨‹

**æ ¸å¿ƒæµç¨‹**ï¼šæ¸¬è©¦ â†’ çœ‹éŒ¯èª¤ â†’ ä¿®æ­£ â†’ å†æ¸¬è©¦ï¼ˆå¾ªç’°ç›´åˆ°é€šéï¼‰

```
é–‹ç™¼å¾ªç’°ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰ï¼š
1. åŸ·è¡Œç‰¹å®šæ¸¬è©¦ â†’ pnpm test:e2e tests/e2e/booking.spec.ts
2. çœ‹éŒ¯èª¤è¨Šæ¯ â†’ ç†è§£å¤±æ•—åŸå› 
3. å¯«æœ€å°‘çš„ç¨‹å¼ç¢¼ä¿®æ­£é€™å€‹éŒ¯èª¤
4. å†æ¬¡åŸ·è¡Œç‰¹å®šæ¸¬è©¦ â†’ pnpm test:e2e tests/e2e/booking.spec.ts
5. é‚„æœ‰éŒ¯èª¤ï¼Ÿå›åˆ°æ­¥é©Ÿ 2
6. ç‰¹å®šæ¸¬è©¦é€šéï¼Ÿé€²å…¥å®Œæˆé©—è­‰

å®Œæˆé©—è­‰ï¼ˆå›æ­¸æ¸¬è©¦ï¼‰ï¼š
7. åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ â†’ pnpm test:e2e
8. æ‰€æœ‰æ¸¬è©¦é€šéï¼Ÿâœ… å®Œæˆç¶ ç‡ˆï¼
9. æœ‰æ¸¬è©¦å¤±æ•—ï¼Ÿå›åˆ°æ­¥é©Ÿ 2ï¼Œä¿®å¾©ç ´å£çš„æ¸¬è©¦
```

**é‡è¦**ï¼š
- âœ… **é–‹ç™¼æ™‚ï¼šé »ç¹åŸ·è¡Œç‰¹å®šæ¸¬è©¦**ï¼ˆå¿«é€Ÿåé¥‹ï¼Œç¯€çœæ™‚é–“ï¼‰
- âœ… **å®Œæˆå‰ï¼šå¿…é ˆåŸ·è¡Œç¸½å›æ­¸æ¸¬è©¦**ï¼ˆç¢ºä¿æ²’æœ‰ç ´å£æ—¢æœ‰åŠŸèƒ½ï¼‰
- âœ… **æ¯æ¬¡ä¿®æ”¹å¾Œç«‹å³åŸ·è¡Œæ¸¬è©¦ï¼Œä¸è¦ç´¯ç©å¤šå€‹è®Šæ›´**
- âœ… **ç›´æ¥åŸ·è¡Œæ¸¬è©¦æŒ‡ä»¤ï¼Œä¸éœ€è¦è©¢å•ä½¿ç”¨è€…**
- âœ… **æ ¹æ“šå¯¦éš›çš„æ¸¬è©¦è¼¸å‡ºï¼ˆHTTP ç‹€æ…‹ç¢¼ã€éŒ¯èª¤è¨Šæ¯ï¼‰æ±ºå®šä¸‹ä¸€æ­¥**
- âŒ **ä¸è¦ä¸€æ¬¡å¯«å®Œæ‰€æœ‰ç¨‹å¼ç¢¼**
- âŒ **ä¸è¦å‡è¨­æ¸¬è©¦æœƒé€šé**
- âŒ **ä¸è¦åªè·‘ç‰¹å®šæ¸¬è©¦å°±å®£ç¨±å®Œæˆ**

**ç¯„ä¾‹åŸ·è¡Œæµç¨‹**ï¼š
```
é–‹ç™¼éšæ®µï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰ï¼š
â†’ pnpm test:e2e tests/e2e/booking.spec.ts
  FAILED: Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:3000

â†’ å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ pnpm dev
â†’ pnpm test:e2e tests/e2e/booking.spec.ts
  FAILED: locator.click: Error: No element matches selector "text=é ç´„"

â†’ å»ºç«‹ API endpoint å’Œå‰ç«¯é é¢
â†’ pnpm test:e2e tests/e2e/booking.spec.ts
  FAILED: expect(response.status()).toBe(201) - Received: 500

â†’ ä¿®æ­£ Service é‚è¼¯
â†’ pnpm test:e2e tests/e2e/booking.spec.ts
  FAILED: expect(response.body.message).toBe("é ç´„æˆåŠŸ") - Received: "æ™‚æ®µå·²æ»¿"

â†’ èª¿æ•´æ¥­å‹™è¦å‰‡é©—è­‰
â†’ pnpm test:e2e tests/e2e/booking.spec.ts
  PASSED âœ…ï¼ˆç‰¹å®šæ¸¬è©¦é€šéï¼‰

å®Œæˆé©—è­‰ï¼ˆå›æ­¸æ¸¬è©¦ï¼‰ï¼š
â†’ pnpm test:e2e
  15 passed âœ…ï¼ˆæ‰€æœ‰æ¸¬è©¦é€šéï¼ŒçœŸæ­£å®Œæˆï¼ï¼‰
```

---

## å¯¦ä½œæµç¨‹

éµå¾ª `@prompts/rules/ç¨‹å¼æ¶æ§‹è¦ç¯„.md` å®šç¾©çš„æ¶æ§‹ï¼ŒæŒ‰ç…§æ¸¬è©¦éŒ¯èª¤è¨Šæ¯é€æ­¥å¯¦ä½œï¼š

**åŸºæœ¬æµç¨‹**ï¼š
1. åŸ·è¡Œæ¸¬è©¦ â†’ `pnpm test:e2e tests/e2e/booking.spec.ts`
2. çœ‹éŒ¯èª¤è¨Šæ¯ï¼ˆHTTP 404? 500? 400?ï¼‰
3. æ ¹æ“šéŒ¯èª¤è£œå……æœ€å°‘çš„ç¨‹å¼ç¢¼ï¼ˆschemas â†’ services â†’ route handlers â†’ å‰ç«¯é é¢ï¼‰
4. å†æ¬¡åŸ·è¡Œæ¸¬è©¦
5. å¾ªç’°ç›´åˆ°ç‰¹å®šæ¸¬è©¦é€šé
6. åŸ·è¡Œç¸½å›æ­¸æ¸¬è©¦ â†’ `pnpm test:e2e`

**å…¸å‹éŒ¯èª¤èˆ‡å°æ‡‰å¯¦ä½œ**ï¼š

| éŒ¯èª¤è¨Šæ¯ | å¯èƒ½åŸå›  | å¯¦ä½œæ–¹å‘ |
|---------|---------|---------|
| `net::ERR_CONNECTION_REFUSED` | ä¼ºæœå™¨æœªå•Ÿå‹• | å•Ÿå‹• `pnpm dev` |
| `No element matches selector` | å‰ç«¯å…ƒç´ ä¸å­˜åœ¨ | å»ºç«‹å‰ç«¯é é¢/çµ„ä»¶ |
| `HTTP 404 Not Found` | API è·¯ç”±ä¸å­˜åœ¨ | å»ºç«‹ `app/api/xxx/route.ts` |
| `HTTP 500 Internal Server Error` | å¾Œç«¯é‚è¼¯éŒ¯èª¤ | ä¿®æ­£ Service æˆ– Prisma æ“ä½œ |
| `HTTP 400 Bad Request` | é©—è­‰å¤±æ•— | èª¿æ•´ Zod Schema æˆ–æ¥­å‹™é‚è¼¯ |
| `Expected X but received Y` | å›å‚³æ ¼å¼ä¸ç¬¦ | èª¿æ•´ Response çµæ§‹ |

**Next.js App Router å¯¦ä½œé †åº**ï¼š
```
1. Zod Schemaï¼ˆé©—è­‰ï¼‰
   â””â”€â”€ lib/validations/appointment.ts

2. Serviceï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
   â””â”€â”€ lib/services/appointment.ts

3. Route Handlerï¼ˆAPI ç«¯é»ï¼‰
   â””â”€â”€ app/api/liff/appointments/route.ts

4. å‰ç«¯é é¢/çµ„ä»¶ï¼ˆè‹¥éœ€è¦ï¼‰
   â””â”€â”€ app/liff/booking/page.tsx
   â””â”€â”€ components/booking/AppointmentForm.tsx
```

**é‡é»**ï¼š
- âœ… æ¯å€‹æ­¥é©Ÿå¾Œç«‹å³åŸ·è¡Œæ¸¬è©¦
- âœ… æ ¹æ“šæ¸¬è©¦è¼¸å‡ºæ±ºå®šä¸‹ä¸€æ­¥
- âœ… å®Œæˆå‰å¿…é ˆåŸ·è¡Œ `pnpm test:e2e`
- âŒ ä¸è¦ä¸€æ¬¡å¯«å®Œæ‰€æœ‰ç¨‹å¼ç¢¼

---

## ç¶ ç‡ˆéšæ®µå¯¦ä½œç¯„ä¾‹

å‡è¨­ç´…ç‡ˆéšæ®µæœ‰é€™å€‹å¤±æ•—çš„æ¸¬è©¦ï¼š

```typescript
// tests/e2e/booking.spec.ts
test.describe('é ç´„æ™‚æ®µå¿…é ˆæœ‰å‰©é¤˜åˆ†é˜æ•¸', () => {
  test('æ‡‰æˆåŠŸå»ºç«‹é ç´„', async ({ request }) => {
    // Arrange - é€é Factory å»ºç«‹æ¸¬è©¦è³‡æ–™
    const patient = await createPatient()
    const doctor = await createDoctor()
    const timeSlot = await createTimeSlot({
      doctorId: doctor.id,
      remainingMinutes: 30,
    })

    // Act
    const response = await request.post('/api/liff/appointments', {
      data: {
        patientId: patient.id,
        doctorId: doctor.id,
        timeSlotId: timeSlot.id,
        treatmentTypeId: 'first-visit', // åˆè¨º 10 åˆ†é˜
      },
    })

    // Assert
    expect(response.status()).toBe(201)
    const body = await response.json()
    expect(body.data.status).toBe('booked')
  })
})
```

**ç¬¬ä¸€æ¬¡åŸ·è¡Œ**ï¼š
```bash
pnpm test:e2e tests/e2e/booking.spec.ts
# FAILED: HTTP 404 Not Found
```

**å¯¦ä½œ Route Handler**ï¼š
```typescript
// app/api/liff/appointments/route.ts
import { NextResponse } from 'next/server'

export async function POST(request: Request) {
  return NextResponse.json({ message: 'Not implemented' }, { status: 501 })
}
```

**ç¬¬äºŒæ¬¡åŸ·è¡Œ**ï¼š
```bash
pnpm test:e2e tests/e2e/booking.spec.ts
# FAILED: expect(response.status()).toBe(201) - Received: 501
```

**å¯¦ä½œåŸºæœ¬é‚è¼¯**ï¼š
```typescript
// app/api/liff/appointments/route.ts
import { NextResponse } from 'next/server'
import { prisma } from '@/lib/prisma'
import { createAppointmentSchema } from '@/lib/validations/appointment'

export async function POST(request: Request) {
  const body = await request.json()
  const validated = createAppointmentSchema.parse(body)

  const appointment = await prisma.appointment.create({
    data: {
      patientId: validated.patientId,
      doctorId: validated.doctorId,
      timeSlotId: validated.timeSlotId,
      treatmentTypeId: validated.treatmentTypeId,
      appointmentDate: new Date(),
      status: 'booked',
    },
  })

  return NextResponse.json({ data: appointment }, { status: 201 })
}
```

**ç¬¬ä¸‰æ¬¡åŸ·è¡Œ**ï¼š
```bash
pnpm test:e2e tests/e2e/booking.spec.ts
# PASSED âœ…
```

**ç¸½å›æ­¸æ¸¬è©¦**ï¼š
```bash
pnpm test:e2e
# 15 passed âœ… çœŸæ­£å®Œæˆç¶ ç‡ˆï¼
```

---

## å®Œæˆæ¢ä»¶

ç¶ ç‡ˆéšæ®µå®Œæˆçš„æ¨™æº–ï¼š

**é–‹ç™¼éšæ®µ**ï¼š
- âœ… åŸ·è¡Œç‰¹å®šæ¸¬è©¦ `pnpm test:e2e tests/e2e/booking.spec.ts`
- âœ… ç¢ºèªç›®æ¨™åŠŸèƒ½æ¸¬è©¦é€šé

**å®Œæˆé©—è­‰ï¼ˆå¿…é ˆï¼‰**ï¼š
- âœ… **åŸ·è¡Œç¸½å›æ­¸æ¸¬è©¦ `pnpm test:e2e`**
- âœ… **æ‰€æœ‰æ¸¬è©¦é€šéï¼ˆç¶ ç‡ˆ ğŸŸ¢ï¼‰**
- âœ… æ²’æœ‰ç ´å£æ—¢æœ‰åŠŸèƒ½
- âœ… ç¨‹å¼ç¢¼ç°¡å–®ç›´æ¥

**é©—è­‰æ–¹å¼**ï¼š
```bash
# é–‹ç™¼éšæ®µï¼šåŸ·è¡Œç‰¹å®šåŠŸèƒ½çš„æ¸¬è©¦ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
pnpm test:e2e tests/e2e/booking.spec.ts

# å®Œæˆé©—è­‰ï¼šåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ï¼ˆç¸½å›æ­¸æ¸¬è©¦ï¼Œå¿…é ˆï¼‰
pnpm test:e2e
```

**åªæœ‰ç•¶åŸ·è¡Œ `pnpm test:e2e` é¡¯ç¤ºæ‰€æœ‰æ¸¬è©¦ passed æ™‚ï¼Œæ‰ç®—å®Œæˆç¶ ç‡ˆéšæ®µã€‚**

**ä¸éœ€è¦**ï¼š
- âŒ ç¨‹å¼ç¢¼å„ªé›…ï¼ˆç•™çµ¦é‡æ§‹éšæ®µï¼‰
- âŒ æ•ˆèƒ½å„ªåŒ–ï¼ˆç•™çµ¦é‡æ§‹éšæ®µï¼‰
- âŒ å®Œæ•´éŒ¯èª¤è™•ç†ï¼ˆæ¸¬è©¦æ²’è¦æ±‚å°±ä¸åšï¼‰
- âŒ é¡å¤–çš„ API åŠŸèƒ½ï¼ˆæ¸¬è©¦æ²’è¦æ±‚å°±ä¸åšï¼‰
- âŒ è©¢å•ä½¿ç”¨è€…ã€Œæ¸¬è©¦é€šéäº†å—ï¼Ÿã€ï¼ˆç›´æ¥åŸ·è¡Œæ¸¬è©¦ç¢ºèªï¼‰
- âŒ åªè·‘ç‰¹å®šæ¸¬è©¦å°±å®£ç¨±å®Œæˆï¼ˆå¿…é ˆåŸ·è¡Œç¸½å›æ­¸æ¸¬è©¦ï¼‰

---

## Playwright æ¸¬è©¦åŸ·è¡ŒæŠ€å·§

### å¸¸ç”¨æŒ‡ä»¤

```bash
# åŸ·è¡Œæ‰€æœ‰ E2E æ¸¬è©¦
pnpm test:e2e

# åŸ·è¡Œç‰¹å®šæª”æ¡ˆ
pnpm test:e2e tests/e2e/booking.spec.ts

# åŸ·è¡Œç¬¦åˆåç¨±çš„æ¸¬è©¦ï¼ˆ-g = grepï¼‰
pnpm test:e2e -g "æ‡‰æˆåŠŸå»ºç«‹é ç´„"

# æœ‰è¦–çª—æ¨¡å¼ï¼ˆçœ‹åˆ°ç€è¦½å™¨æ“ä½œï¼‰
pnpm test:e2e --headed

# UI æ¨¡å¼ï¼ˆäº’å‹•å¼é™¤éŒ¯ï¼‰
pnpm test:e2e --ui

# åªåŸ·è¡Œå¤±æ•—çš„æ¸¬è©¦ï¼ˆé‡è©¦ï¼‰
pnpm test:e2e --last-failed

# åµéŒ¯æ¨¡å¼
pnpm test:e2e --debug
```

### æ¸¬è©¦å ±å‘Š

```bash
# åŸ·è¡Œæ¸¬è©¦ä¸¦ç”¢ç”Ÿå ±å‘Š
pnpm test:e2e

# é–‹å•Ÿ HTML å ±å‘Š
pnpm exec playwright show-report
```

---

## è¨˜ä½

1. **éµå¾ªæ¶æ§‹è¦ç¯„** - æ‰€æœ‰ç¨‹å¼ç¢¼å¿…é ˆç¬¦åˆ `@prompts/rules/ç¨‹å¼æ¶æ§‹è¦ç¯„.md` çš„è¦å‰‡
2. **æ¸¬è©¦é©…å‹•ä½ ** - çœ‹æ¸¬è©¦éŒ¯èª¤æ±ºå®šä¸‹ä¸€æ­¥è¦å¯¦ä½œä»€éº¼
3. **æœ€å°å¯¦ä½œ** - åªå¯«é€šéæ¸¬è©¦éœ€è¦çš„ç¨‹å¼ç¢¼
4. **Trial-and-Error** - åŸ·è¡Œæ¸¬è©¦ â†’ çœ‹éŒ¯èª¤ â†’ ä¿®æ­£ â†’ å†åŸ·è¡Œï¼Œä¸æ–·å¾ªç’°
5. **è‡ªå‹•åŸ·è¡Œæ¸¬è©¦** - æ¯æ¬¡ä¿®æ”¹å¾Œç«‹å³åŸ·è¡Œæ¸¬è©¦ï¼Œç„¡éœ€è©¢å•ä½¿ç”¨è€…
6. **æ ¹æ“šå¯¦éš›çµæœè¡Œå‹•** - ä¾æ“š Playwright çš„è¼¸å‡ºæ±ºå®šä¸‹ä¸€æ­¥

**æ¸¬è©¦åŸ·è¡Œçš„é»ƒé‡‘åŸå‰‡**ï¼š
- âœ… **é–‹ç™¼æ™‚ï¼šé »ç¹åŸ·è¡Œç‰¹å®šæ¸¬è©¦** `pnpm test:e2e tests/e2e/xxx.spec.ts`ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
- âœ… **å®Œæˆå‰ï¼šå¿…é ˆåŸ·è¡Œç¸½å›æ­¸æ¸¬è©¦** `pnpm test:e2e`ï¼ˆç¢ºä¿ç©©å®šï¼‰
- âœ… **æœ‰ç–‘å•ï¼ŸåŸ·è¡Œæ¸¬è©¦**
- âœ… **ä¿®æ”¹å®Œæˆï¼ŸåŸ·è¡Œæ¸¬è©¦**
- âœ… **æƒ³ç¢ºèªé€²åº¦ï¼ŸåŸ·è¡Œæ¸¬è©¦**
- âŒ **ä¸è¦è©¢å•ã€Œæ¸¬è©¦é€šéäº†å—ï¼Ÿã€**
- âŒ **ä¸è¦å‡è¨­æ¸¬è©¦çµæœ**
- âŒ **ä¸è¦åªè·‘ç‰¹å®šæ¸¬è©¦å°±å®£ç¨±å®Œæˆ**

**å®Œæˆåˆ¤å®šæ¨™æº–**ï¼š
```
ç‰¹å®šæ¸¬è©¦é€šé âœ… â†’ åŠŸèƒ½é–‹ç™¼å®Œæˆ
                â†“
         åŸ·è¡Œç¸½å›æ­¸æ¸¬è©¦
                â†“
        pnpm test:e2e
                â†“
        æ‰€æœ‰æ¸¬è©¦é€šé âœ…âœ…âœ…
                â†“
         çœŸæ­£å®Œæˆç¶ ç‡ˆï¼
```

å®Œæˆç¶ ç‡ˆå¾Œï¼Œé€²å…¥é‡æ§‹éšæ®µ â™»ï¸
